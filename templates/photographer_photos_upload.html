{% extends "photographer_base.html" %}
{% block title %}å†™çœŸã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ - {{ event.title }} - NAGORI{% endblock %}
{% block page_title %}å†™çœŸã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰{% endblock %}

{% block content %}
<div class="mb-2">
  <a href="{{ url_for('photographer_event_detail', event_id=event.id) }}" class="text-muted" style="text-decoration: none;">
    â† {{ event.title }} ã«æˆ»ã‚‹
  </a>
</div>

<div class="card" style="max-width: 700px;">
  <div class="card-header">
    <h3 class="card-title">ğŸ“· å†™çœŸã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</h3>
  </div>
  <div class="card-body">
    <form method="POST" action="{{ url_for('photographer_photos_upload', event_id=event.id) }}" enctype="multipart/form-data" id="upload-form">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
      <div class="upload-zone" id="upload-zone">
        <div class="upload-icon">ğŸ“</div>
        <h4>ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—</h4>
        <p class="text-muted">ã¾ãŸã¯</p>
        <label class="btn btn-primary">
          ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ
          <input type="file" name="photos" multiple accept="image/*" style="display: none;" id="file-input">
        </label>
        <p class="form-hint mt-2">JPG, PNGå½¢å¼ã«å¯¾å¿œã€‚è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠå¯ã€‚</p>
      </div>
      
      <div id="preview-container" style="display: none;">
        <div class="preview-header">
          <span id="file-count">0æšé¸æŠä¸­</span>
          <button type="button" class="btn btn-outline btn-sm" onclick="clearFiles()">ã‚¯ãƒªã‚¢</button>
        </div>
        <div class="preview-grid" id="preview-grid"></div>
      </div>
      
      <div class="mt-3">
        <button type="submit" class="btn btn-primary btn-lg" id="submit-btn" disabled>
          ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹
        </button>
      </div>
    </form>
  </div>
</div>

<style>
  .upload-zone {
    border: 2px dashed var(--border);
    border-radius: 12px;
    padding: 3rem 2rem;
    text-align: center;
    transition: all 0.2s;
    cursor: pointer;
  }
  
  .upload-zone:hover,
  .upload-zone.dragover {
    border-color: var(--primary);
    background: rgba(0, 102, 255, 0.05);
  }
  
  .upload-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
    opacity: 0.5;
  }
  
  .preview-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--border);
  }
  
  .preview-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
    gap: 0.75rem;
    max-height: 300px;
    overflow-y: auto;
  }
  
  .preview-item {
    aspect-ratio: 1;
    border-radius: 8px;
    overflow: hidden;
    background: var(--gray-800);
  }
  
  .preview-item img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
</style>

<script>
const uploadZone = document.getElementById('upload-zone');
const fileInput = document.getElementById('file-input');
const previewContainer = document.getElementById('preview-container');
const previewGrid = document.getElementById('preview-grid');
const fileCount = document.getElementById('file-count');
const submitBtn = document.getElementById('submit-btn');

let selectedFiles = new DataTransfer();

// ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—
uploadZone.addEventListener('dragover', (e) => {
  e.preventDefault();
  uploadZone.classList.add('dragover');
});

uploadZone.addEventListener('dragleave', () => {
  uploadZone.classList.remove('dragover');
});

uploadZone.addEventListener('drop', (e) => {
  e.preventDefault();
  uploadZone.classList.remove('dragover');
  handleFiles(e.dataTransfer.files);
});

uploadZone.addEventListener('click', () => {
  fileInput.click();
});

fileInput.addEventListener('change', (e) => {
  handleFiles(e.target.files);
});

function handleFiles(files) {
  for (let file of files) {
    if (file.type.startsWith('image/')) {
      selectedFiles.items.add(file);
    }
  }
  updatePreview();
}

function updatePreview() {
  previewGrid.innerHTML = '';
  const files = selectedFiles.files;
  
  if (files.length > 0) {
    previewContainer.style.display = 'block';
    uploadZone.style.display = 'none';
    fileCount.textContent = `${files.length}æšé¸æŠä¸­`;
    submitBtn.disabled = false;
    
    for (let file of files) {
      const reader = new FileReader();
      reader.onload = (e) => {
        const div = document.createElement('div');
        div.className = 'preview-item';
        div.innerHTML = `<img src="${e.target.result}" alt="${file.name}">`;
        previewGrid.appendChild(div);
      };
      reader.readAsDataURL(file);
    }
    
    fileInput.files = selectedFiles.files;
  } else {
    previewContainer.style.display = 'none';
    uploadZone.style.display = 'block';
    submitBtn.disabled = true;
  }
}

function clearFiles() {
  selectedFiles = new DataTransfer();
  fileInput.value = '';
  updatePreview();
}

document.getElementById('upload-form').addEventListener('submit', function() {
  submitBtn.disabled = true;
  submitBtn.textContent = 'ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­...';
});
</script>
{% endblock %}

