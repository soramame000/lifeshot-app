{% extends "photographer_base.html" %}
{% block title %}å£²ä¸Šç¢ºèª - NAGORI{% endblock %}
{% block page_title %}å£²ä¸Šç¢ºèª{% endblock %}

{% block content %}
<div class="stats-grid">
  <div class="stat-card">
    <div class="stat-label">ç´¯è¨ˆå£²ä¸Šï¼ˆã‚ãªãŸã®å–ã‚Šåˆ†ï¼‰</div>
    <div class="stat-value">Â¥{{ "{:,}".format(total_sales) }}</div>
  </div>
  <div class="stat-card">
    <div class="stat-label">ç´¯è¨ˆæ³¨æ–‡æ•°</div>
    <div class="stat-value">{{ orders|length }}ä»¶</div>
  </div>
</div>

{% if chart_labels %}
<div class="card mb-3">
  <div class="card-header">
    <h3 class="card-title">ğŸ“ˆ å£²ä¸Šæ¨ç§»ï¼ˆéå»30æ—¥ï¼‰</h3>
  </div>
  <div class="card-body">
    <canvas id="salesChart" height="100"></canvas>
  </div>
</div>
{% endif %}

<div class="card">
  <div class="card-header">
    <h3 class="card-title">ğŸ’° æ³¨æ–‡ä¸€è¦§</h3>
  </div>
  {% if orders %}
  <div class="table-container">
    <table class="table">
      <thead>
        <tr>
          <th>æ—¥æ™‚</th>
          <th>ã‚¤ãƒ™ãƒ³ãƒˆ</th>
          <th>è³¼å…¥è€…</th>
          <th>æšæ•°</th>
          <th class="text-right">åˆè¨ˆ</th>
          <th class="text-right">ã‚ãªãŸã®å–ã‚Šåˆ†</th>
        </tr>
      </thead>
      <tbody>
        {% for order in orders %}
        <tr>
          <td class="text-muted">{{ order.created_at.strftime('%Y/%m/%d %H:%M') }}</td>
          <td>{{ order.event.title if order.event else '-' }}</td>
          <td>{{ order.buyer_name }}</td>
          <td>{{ order.items|length }}æš</td>
          <td class="text-right text-muted">Â¥{{ "{:,}".format(order.total_amount) }}</td>
          <td class="text-right"><strong>Â¥{{ "{:,}".format(order.photographer_amount) }}</strong></td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <div class="card-body">
    <div class="empty-state">
      <div class="empty-state-icon">ğŸ’°</div>
      <h4 class="empty-state-title">ã¾ã å£²ä¸ŠãŒã‚ã‚Šã¾ã›ã‚“</h4>
      <p class="empty-state-desc">å†™çœŸãŒå£²ã‚Œã‚‹ã¨ã€ã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</p>
    </div>
  </div>
  {% endif %}
</div>

{% if chart_labels %}
<div id="salesChartData" 
     data-labels='{{ chart_labels|tojson }}' 
     data-values='{{ chart_values|tojson }}'
     style="display:none;"></div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
(function() {
  var chartDataEl = document.getElementById('salesChartData');
  var chartLabels = JSON.parse(chartDataEl.getAttribute('data-labels') || '[]');
  var chartValues = JSON.parse(chartDataEl.getAttribute('data-values') || '[]');
  
  var ctx = document.getElementById('salesChart').getContext('2d');
  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: chartLabels,
      datasets: [{
        label: 'å£²ä¸Š',
        data: chartValues,
        backgroundColor: 'rgba(0, 102, 255, 0.5)',
        borderColor: 'rgba(0, 102, 255, 1)',
        borderWidth: 1,
        borderRadius: 4
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: false
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          grid: {
            color: 'rgba(255, 255, 255, 0.05)'
          },
          ticks: {
            color: '#64748b',
            callback: function(value) {
              return 'Â¥' + value.toLocaleString();
            }
          }
        },
        x: {
          grid: {
            display: false
          },
          ticks: {
            color: '#64748b'
          }
        }
      }
    }
  });
})();
</script>
{% endif %}
{% endblock %}

