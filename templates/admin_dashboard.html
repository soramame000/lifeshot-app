{% extends "admin_base.html" %}
{% block title %}é‹å–¶ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ - LifeShot{% endblock %}
{% block page_title %}é‹å–¶ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰{% endblock %}

{% block content %}
<div class="stats-grid">
  <div class="stat-card">
    <div class="stat-label">ä»Šæœˆã®GMVï¼ˆæµé€šç·é¡ï¼‰</div>
    <div class="stat-value">Â¥{{ "{:,}".format(monthly_gmv) }}</div>
  </div>
  <div class="stat-card">
    <div class="stat-label">ä»Šæœˆã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ æ‰‹æ•°æ–™</div>
    <div class="stat-value">Â¥{{ "{:,}".format(monthly_platform_fee) }}</div>
  </div>
  <div class="stat-card">
    <div class="stat-label">ç´¯è¨ˆGMV</div>
    <div class="stat-value">Â¥{{ "{:,}".format(total_gmv) }}</div>
  </div>
  <div class="stat-card">
    <div class="stat-label">ç´¯è¨ˆãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ æ‰‹æ•°æ–™</div>
    <div class="stat-value">Â¥{{ "{:,}".format(total_platform_fee) }}</div>
  </div>
</div>

<div class="stats-grid">
  <div class="stat-card">
    <div class="stat-label">ç™»éŒ²ã‚«ãƒ¡ãƒ©ãƒãƒ³æ•°</div>
    <div class="stat-value">{{ total_photographers }}å</div>
    <div class="text-muted" style="margin-top: 0.5rem; font-size: 0.8rem;">
      ã‚¢ã‚¯ãƒ†ã‚£ãƒ–: {{ active_photographers }}å
    </div>
  </div>
  <div class="stat-card">
    <div class="stat-label">ã‚¤ãƒ™ãƒ³ãƒˆæ•°</div>
    <div class="stat-value">{{ total_events }}ä»¶</div>
    <div class="text-muted" style="margin-top: 0.5rem; font-size: 0.8rem;">
      å…¬é–‹ä¸­: {{ published_events }}ä»¶
    </div>
  </div>
</div>

{% if chart_labels %}
<div class="card mb-3">
  <div class="card-header">
    <h3 class="card-title">ğŸ“ˆ æ—¥åˆ¥GMVæ¨ç§»ï¼ˆéå»30æ—¥ï¼‰</h3>
  </div>
  <div class="card-body">
    <canvas id="gmvChart" height="100"></canvas>
  </div>
</div>
{% endif %}

<div class="card">
  <div class="card-header">
    <h3 class="card-title">ğŸ’° æœ€è¿‘ã®æ³¨æ–‡</h3>
    <a href="{{ url_for('admin_sales') }}" class="btn btn-outline btn-sm">ã™ã¹ã¦è¦‹ã‚‹</a>
  </div>
  {% if recent_orders %}
  <div class="table-container">
    <table class="table">
      <thead>
        <tr>
          <th>æ—¥æ™‚</th>
          <th>ã‚¤ãƒ™ãƒ³ãƒˆ</th>
          <th>è³¼å…¥è€…</th>
          <th class="text-right">GMV</th>
          <th class="text-right">æ‰‹æ•°æ–™</th>
        </tr>
      </thead>
      <tbody>
        {% for order in recent_orders %}
        <tr>
          <td class="text-muted">{{ order.created_at.strftime('%Y/%m/%d %H:%M') }}</td>
          <td>{{ order.event.title if order.event else '-' }}</td>
          <td>{{ order.buyer_name }}</td>
          <td class="text-right">Â¥{{ "{:,}".format(order.total_amount) }}</td>
          <td class="text-right">Â¥{{ "{:,}".format(order.platform_fee) }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <div class="card-body">
    <p class="text-muted text-center">ã¾ã æ³¨æ–‡ãŒã‚ã‚Šã¾ã›ã‚“</p>
  </div>
  {% endif %}
</div>

{% if chart_labels %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const ctx = document.getElementById('gmvChart').getContext('2d');
new Chart(ctx, {
  type: 'bar',
  data: {
    labels: {{ chart_labels|tojson }},
    datasets: [{
      label: 'GMV',
      data: {{ chart_values|tojson }},
      backgroundColor: 'rgba(139, 92, 246, 0.5)',
      borderColor: 'rgba(139, 92, 246, 1)',
      borderWidth: 1,
      borderRadius: 4,
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    plugins: { legend: { display: false } },
    scales: {
      y: {
        beginAtZero: true,
        grid: { color: 'rgba(255, 255, 255, 0.05)' },
        ticks: {
          color: '#64748b',
          callback: function(value) { return 'Â¥' + value.toLocaleString(); }
        }
      },
      x: {
        grid: { display: false },
        ticks: { color: '#64748b' }
      }
    }
  }
});
</script>
{% endif %}
{% endblock %}

